<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shuma-Gorath Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes@0.5.0/dist/chartjs-plugin-colorschemes.min.js"></script>
</head>

<body>
  <div class="container panel panel-border">
    <header>
      <div class="shuma-image-wrapper">
        <img src="assets/shuma-gorath.png" alt="Shuma-Gorath" class="shuma-gorath-img">
      </div>
      <h1>Shuma-Gorath</h1>
      <p class="subtitle text-muted">Many-Angled Bot Defence</p>
      <div id="test-mode-banner" class="test-mode-banner hidden">TEST MODE ACTIVE - Logging only, no blocking</div>
      <span id="last-updated" class="text-muted"></span>
    </header>

    <!-- Stats Summary Cards -->
    <div class="stats-cards">
      <div class="card panel panel-border pad-lg">
        <h3 class="caps-label">Total Bans</h3>
        <div class="stat-value" id="total-bans">-</div>
      </div>
      <div class="card panel panel-border pad-lg">
        <h3 class="caps-label">Active Bans</h3>
        <div class="stat-value" id="active-bans">-</div>
      </div>
      <div class="card panel panel-border pad-lg">
        <h3 class="caps-label">Events (24h)</h3>
        <div class="stat-value" id="total-events">-</div>
      </div>
      <div class="card panel panel-border pad-lg">
        <h3 class="caps-label">Unique IPs</h3>
        <div class="stat-value" id="unique-ips">-</div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
      <div class="chart-container panel-soft panel-border pad-md">
        <h2>Event Types (24h)</h2>
        <canvas id="eventTypesChart"></canvas>
      </div>
      <div class="chart-container panel-soft panel-border pad-md">
        <h2>Top 10 IPs by Events</h2>
        <canvas id="topIpsChart"></canvas>
      </div>
    </div>

    <!-- Events Over Time -->
    <div class="section">
      <div class="chart-header">
        <h2>Events Over Time</h2>
        <div class="time-range-buttons">
          <button class="btn time-btn active" data-range="hour">60 Mins</button>
          <button class="btn time-btn" data-range="day">24 Hours</button>
          <button class="btn time-btn" data-range="week">7 Days</button>
          <button class="btn time-btn" data-range="month">30 Days</button>
        </div>
      </div>
      <div class="chart-container panel-soft panel-border pad-md">
        <canvas id="timeSeriesChart"></canvas>
      </div>
    </div>

    <!-- Recent Events -->
    <div class="section events">
      <h2>Recent Events (Last 100)</h2>
      <div class="table-wrapper">
        <table id="events" class="panel panel-border">
          <thead>
            <tr>
              <th class="caps-label">Time</th>
              <th class="caps-label">Type</th>
              <th class="caps-label">IP</th>
              <th class="caps-label">Reason</th>
              <th class="caps-label">Outcome</th>
              <th class="caps-label">Admin</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Maze Activity Section -->
    <div class="section maze-section panel panel-border pad-md">
      <h2>Link Maze Honeypot</h2>
      <p class="section-desc text-muted">Crawlers trapped in infinite fake pages</p>
      <div class="maze-stats">
        <div class="maze-stat panel panel-border pad-md">
          <span class="maze-label caps-label">Total Hits</span>
          <span class="maze-value" id="maze-total-hits">-</span>
        </div>
        <div class="maze-stat panel panel-border pad-md">
          <span class="maze-label caps-label">Unique Crawlers</span>
          <span class="maze-value" id="maze-unique-crawlers">-</span>
        </div>
        <div class="maze-stat panel panel-border pad-md">
          <span class="maze-label caps-label">Auto-Banned</span>
          <span class="maze-value" id="maze-auto-bans">-</span>
        </div>
      </div>
      <div class="maze-crawlers panel panel-border pad-md">
        <h3>Top Crawlers in Maze</h3>
        <div class="crawler-list" id="maze-crawler-list">
          <p class="no-data">No crawlers in maze yet</p>
        </div>
      </div>
    </div>

    <!-- Admin Controls -->
    <div class="section admin-section">
    <h2>Admin Controls</h2>
      <div class="admin-groups">
        <section class="admin-group admin-group--status">
          <h3 class="admin-group-title">Banning</h3>
          <table id="bans-table" class="panel panel-border bans-table-admin">
            <thead>
              <tr>
                <th class="caps-label">IP Address</th>
                <th class="caps-label">Reason</th>
                <th class="caps-label">Banned At</th>
                <th class="caps-label">Expires</th>
                <th class="caps-label">Signals</th>
                <th class="caps-label">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="controls-grid controls-grid--manual">
            <div class="control-group panel-soft pad-md">
              <h3>Ban IP</h3>
              <input id="ban-ip" class="input-field" type="text" placeholder="IP address" aria-label="IP address to ban" />
              <input id="ban-reason" class="input-field" type="text" placeholder="Reason (optional)" value="manual_ban" aria-label="Ban reason" />
              <input id="ban-duration" class="input-field" type="number" placeholder="Duration (seconds)" value="3600" aria-label="Ban duration in seconds" />
              <button id="ban-btn" class="btn btn-dark">Ban</button>
            </div>
            <div class="control-group panel-soft pad-md">
              <h3>Unban IP</h3>
              <input id="unban-ip" class="input-field" type="text" placeholder="IP address" aria-label="IP address to unban" />
              <button id="unban-btn" class="btn btn-subtle">Unban</button>
            </div>
          </div>
        </section>

        <section class="admin-group admin-group--status">
          <h3 class="admin-group-title">Status</h3>
          <div class="controls-grid controls-grid--status">
            <div class="control-group panel-soft pad-md">
              <div id="status-items"></div>
            </div>
          </div>
        </section>

        <section class="admin-group">
          <h3 class="admin-group-title">Config</h3>
          <div class="controls-grid controls-grid--config">
            <div class="control-group panel-soft pad-md">
              <h3>API Access</h3>
              <div class="config">
                <label for="endpoint">API Endpoint:</label>
                <input id="endpoint" class="input-field input-field--mono" value="http://127.0.0.1:3000" size="30" aria-label="API endpoint">
                <label for="apikey">API Key:</label>
                <input id="apikey" class="input-field input-field--mono" value="changeme-dev-only-api-key" size="30" type="password" aria-label="API key">
                <button id="refresh" class="btn" aria-label="Refresh dashboard">Refresh</button>
              </div>
            </div>
            <div class="control-group panel-soft pad-md">
              <h3>Test Mode</h3>
              <p class="control-desc text-muted">When enabled, logs actions without blocking users</p>
              <div class="admin-controls">
                <div class="toggle-row">
                  <label class="control-label control-label--wide" for="test-mode-toggle">Enable Test Mode</label>
                  <label class="toggle-switch" for="test-mode-toggle">
                    <input type="checkbox" id="test-mode-toggle" aria-label="Enable Test Mode">
                    <span class="toggle-slider"></span>
                  </label>
                </div>
              </div>
              <span id="test-mode-status" class="text-muted status-value">LOADING...</span>
            </div>
            <div class="control-group panel-soft pad-md">
              <h3>AI Training Opt-Out Policy</h3>
              <p class="control-desc text-muted">Declare crawling policies via robots.txt (advisory, not enforcement)</p>
              <div class="admin-controls">
                <div class="toggle-row">
                  <label class="control-label control-label--wide" for="robots-enabled-toggle">Serve robots.txt</label>
                  <label class="toggle-switch">
                    <input type="checkbox" id="robots-enabled-toggle" checked aria-label="Serve robots.txt">
                    <span class="toggle-slider"></span>
                  </label>
                </div>
                <div class="toggle-row">
                  <label class="control-label control-label--wide" for="robots-block-training-toggle">Opt-out AI Training</label>
                  <label class="toggle-switch">
                    <input type="checkbox" id="robots-block-training-toggle" checked aria-label="Opt-out AI training">
                    <span class="toggle-slider"></span>
                  </label>
                  <span class="toggle-hint">GPTBot, CCBot, ClaudeBot</span>
                </div>
                <div class="toggle-row">
                  <label class="control-label control-label--wide" for="robots-block-search-toggle">Opt-out AI Search</label>
                  <label class="toggle-switch">
                    <input type="checkbox" id="robots-block-search-toggle" aria-label="Opt-out AI search">
                    <span class="toggle-slider"></span>
                  </label>
                  <span class="toggle-hint">PerplexityBot, etc.</span>
                </div>
                <div class="toggle-row">
                  <label class="control-label control-label--wide" for="robots-allow-search-toggle">Restrict Search Engines</label>
                  <label class="toggle-switch">
                    <input type="checkbox" id="robots-allow-search-toggle" aria-label="Restrict search engines">
                    <span class="toggle-slider"></span>
                  </label>
                  <span class="toggle-hint">Google, Bing, etc.</span>
                </div>
                <div class="input-row">
                  <label class="control-label control-label--wide" for="robots-crawl-delay">Crawl Delay (seconds)</label>
                  <input class="input-field" type="number" id="robots-crawl-delay" value="2" min="0" max="60" aria-label="Robots crawl delay in seconds">
                </div>
              </div>
              <button id="save-robots-config" class="btn" disabled>Update Policy</button>
              <button id="preview-robots" class="btn btn-subtle">Show robots.txt</button>
              <div id="robots-preview" class="robots-preview panel hidden pad-sm">
                <h4>robots.txt Preview</h4>
                <pre id="robots-preview-content"></pre>
              </div>
            </div>
            <div class="control-group panel-soft pad-md">
              <h3>Link Maze</h3>
              <p class="control-desc text-muted">Honeypot trap for crawlers</p>
              <div class="admin-controls">
                <div class="toggle-row">
                  <label class="control-label" for="maze-enabled-toggle">Maze Enabled</label>
                  <label class="toggle-switch">
                    <input type="checkbox" id="maze-enabled-toggle" checked aria-label="Enable maze honeypot">
                    <span class="toggle-slider"></span>
                  </label>
                </div>
                <div class="toggle-row">
                  <label class="control-label" for="maze-auto-ban-toggle">Auto-Ban</label>
                  <label class="toggle-switch">
                    <input type="checkbox" id="maze-auto-ban-toggle" checked aria-label="Enable maze auto-ban">
                    <span class="toggle-slider"></span>
                  </label>
                </div>
                <div class="input-row">
                  <label class="control-label" for="maze-threshold">Ban Threshold (pages)</label>
                  <input class="input-field" type="number" id="maze-threshold" value="50" min="5" max="500" aria-label="Maze ban threshold in pages">
                </div>
              </div>
              <button id="save-maze-config" class="btn">Save Maze Settings</button>
            </div>
            <div class="control-group panel-soft pad-md">
              <h3>GEO Policy</h3>
              <p class="control-desc text-muted">Use 2-letter country codes (comma separated). Precedence: Block > Maze > Challenge > Allow.</p>
              <div class="admin-controls">
                <div class="input-row">
                  <label class="control-label" for="geo-risk-list">Scoring Countries</label>
                  <input class="input-field" type="text" id="geo-risk-list" placeholder="CN, RU, KP" aria-label="GEO scoring countries">
                </div>
                <div class="input-row">
                  <label class="control-label" for="geo-allow-list">Allow Countries</label>
                  <input class="input-field" type="text" id="geo-allow-list" placeholder="US, GB" aria-label="GEO allow countries">
                </div>
                <div class="input-row">
                  <label class="control-label" for="geo-challenge-list">Challenge Countries</label>
                  <input class="input-field" type="text" id="geo-challenge-list" placeholder="BR, IN" aria-label="GEO challenge countries">
                </div>
                <div class="input-row">
                  <label class="control-label" for="geo-maze-list">Maze Countries</label>
                  <input class="input-field" type="text" id="geo-maze-list" placeholder="RU, CN" aria-label="GEO maze countries">
                </div>
                <div class="input-row">
                  <label class="control-label" for="geo-block-list">Block Countries</label>
                  <input class="input-field" type="text" id="geo-block-list" placeholder="KP" aria-label="GEO block countries">
                </div>
              </div>
              <button id="save-geo-config" class="btn" disabled>Save GEO Settings</button>
            </div>
            <div class="control-group panel-soft pad-md">
              <h3>CDP (Detect Browser Automation)</h3>
              <p class="control-desc text-muted">Detects bots controlling browsers on behalf of human users (Puppeteer, Playwright,
                Selenium, etc.)</p>
              <div class="admin-controls">
                <div class="toggle-row">
                  <label class="control-label control-label--wide" for="cdp-enabled-toggle">Enable Detection</label>
                  <label class="toggle-switch">
                    <input type="checkbox" id="cdp-enabled-toggle" checked aria-label="Enable CDP detection">
                    <span class="toggle-slider"></span>
                  </label>
                </div>
                <div class="toggle-row">
                  <label class="control-label control-label--wide" for="cdp-auto-ban-toggle">Auto-ban on Detection</label>
                  <label class="toggle-switch">
                    <input type="checkbox" id="cdp-auto-ban-toggle" checked aria-label="Enable CDP auto-ban">
                    <span class="toggle-slider"></span>
                  </label>
                </div>
                <div class="slider-control">
                  <div class="slider-header">
                    <label class="control-label control-label--wide" for="cdp-threshold-slider">Detection Threshold</label>
                    <span id="cdp-threshold-value" class="slider-badge">0.6</span>
                  </div>
                  <input type="range" id="cdp-threshold-slider" min="0.3" max="1.0" step="0.1" value="0.6" aria-label="CDP detection threshold">
                  <div class="slider-labels">
                    <span>Sensitive</span>
                    <span>Strict</span>
                  </div>
                </div>
              </div>
              <button id="save-cdp-config" class="btn" disabled>Save CDP Settings</button>
              <div id="cdp-stats" class="info-panel panel-muted pad-sm">
                <h4>Detection Stats</h4>
                <div class="info-row">
                  <span class="info-label text-muted">Total Detections:</span>
                  <span id="cdp-total-detections">0</span>
                </div>
                <div class="info-row">
                  <span class="info-label text-muted">Auto-bans:</span>
                  <span id="cdp-auto-bans">0</span>
                </div>
              </div>
            </div>
            <div class="control-group panel-soft pad-md">
              <h3>Proof-of-Work (PoW)</h3>
              <p class="control-desc text-muted">Lightweight PoW before JS verification (tunable when allowed)</p>
              <div class="admin-controls">
                <div class="input-row">
                  <label class="control-label" for="pow-difficulty">Difficulty (bits)</label>
                  <input class="input-field" type="number" id="pow-difficulty" min="12" max="20" value="15" aria-label="PoW difficulty in leading zero bits">
                </div>
                <div class="input-row">
                  <label class="control-label" for="pow-ttl">Seed TTL (seconds)</label>
                  <input class="input-field" type="number" id="pow-ttl" min="30" max="300" value="90" aria-label="PoW seed TTL in seconds">
                </div>
              </div>
              <button id="save-pow-config" class="btn" disabled>Save PoW Settings</button>
            </div>
            <div class="control-group panel-soft pad-md">
              <h3>Ban Durations</h3>
              <p class="control-desc text-muted">Configure ban duration per offense type (seconds)</p>
              <div class="duration-grid">
                <label for="dur-honeypot">Honeypot:</label> <input id="dur-honeypot" class="input-field" type="number" value="86400" />
                <label for="dur-rate-limit">Rate Limit:</label> <input id="dur-rate-limit" class="input-field" type="number" value="3600" />
                <label for="dur-browser">Browser:</label> <input id="dur-browser" class="input-field" type="number" value="21600" />
                <label for="dur-admin">Admin:</label> <input id="dur-admin" class="input-field" type="number" value="21600" />
              </div>
              <button id="save-durations-btn" class="btn btn-dark">Save Durations</button>
            </div>
          </div>
        </section>

        <section class="admin-group">
          <h3 class="admin-group-title">Tuning Bot Detection</h3>
          <div class="controls-grid controls-grid--tuning">
            <div class="control-group panel-soft pad-md">
              <h3>Botness Scoring</h3>
              <p class="control-desc text-muted">Weighted signals form a unified score. Moderate scores get the challenge; higher scores route to maze.</p>
              <div class="admin-controls">
                <div class="input-row">
                  <label class="control-label" for="challenge-threshold">Challenge (score)</label>
                  <input class="input-field" type="number" id="challenge-threshold" min="1" max="10" value="3" aria-label="Challenge risk threshold">
                </div>
                <div class="input-row">
                  <label class="control-label" for="maze-threshold-score">Maze (score)</label>
                  <input class="input-field" type="number" id="maze-threshold-score" min="1" max="10" value="6" aria-label="Maze risk threshold">
                </div>
                <div class="input-row">
                  <label class="control-label" for="weight-js-required">Weight: JS (points)</label>
                  <input class="input-field" type="number" id="weight-js-required" min="0" max="10" value="1" aria-label="Weight for JS verification required">
                </div>
                <div class="input-row">
                  <label class="control-label" for="weight-geo-risk">Weight: Geo (points)</label>
                  <input class="input-field" type="number" id="weight-geo-risk" min="0" max="10" value="2" aria-label="Weight for high-risk geography">
                </div>
                <div class="input-row">
                  <label class="control-label" for="weight-rate-medium">Weight: Rate 50% (points)</label>
                  <input class="input-field" type="number" id="weight-rate-medium" min="0" max="10" value="1" aria-label="Weight for medium rate pressure">
                </div>
                <div class="input-row">
                  <label class="control-label" for="weight-rate-high">Weight: Rate 80% (points)</label>
                  <input class="input-field" type="number" id="weight-rate-high" min="0" max="10" value="2" aria-label="Weight for high rate pressure">
                </div>
                <div class="info-panel panel-muted pad-sm">
                  <h4>Status</h4>
                  <div class="info-row">
                    <span class="info-label text-muted">Config:</span>
                    <span id="botness-config-status" class="status-value">--</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label text-muted">Default Challenge:</span>
                    <span id="challenge-default">--</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label text-muted">Default Maze:</span>
                    <span id="maze-threshold-default">--</span>
                  </div>
                </div>
                <div class="info-panel panel-muted pad-sm">
                  <h4>Scored Signals</h4>
                  <div id="botness-signal-list"></div>
                </div>
                <div class="info-panel panel-muted pad-sm">
                  <h4>Terminal Signals</h4>
                  <div id="botness-terminal-list"></div>
                </div>
              </div>
              <button id="save-botness-config" class="btn" disabled>Save Botness Settings</button>
            </div>
          </div>
        </section>
      </div>
      <div id="admin-msg" class="message"></div>
    </div>

  </div>
  <script src="dashboard.js"></script>
  <script src="admin.js"></script>
</body>

</html>
