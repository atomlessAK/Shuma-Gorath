[![CI](https://github.com/atomless/Shuma-Gorath/actions/workflows/ci.yml/badge.svg?branch=main)](https://github.com/atomless/Shuma-Gorath/actions/workflows/ci.yml)
[![Dashboard E2E](https://github.com/atomless/Shuma-Gorath/actions/workflows/dashboard-e2e.yml/badge.svg?branch=main)](https://github.com/atomless/Shuma-Gorath/actions/workflows/dashboard-e2e.yml)
[![CodeQL](https://github.com/atomless/Shuma-Gorath/actions/workflows/codeql.yml/badge.svg?branch=main)](https://github.com/atomless/Shuma-Gorath/actions/workflows/codeql.yml)

<p align="center"><img src="dashboard/assets/shuma-gorath-pencil.png" alt-text="Shuma-Gorath" style="display: block; width:300px; margin: 0 auto" /></p>

# üêô Shuma-Gorath

A WebAssembly Bot Defence for Spin. [Shuma-Gorath](https://en.wikipedia.org/wiki/Shuma-Gorath) detects, blocks, and monitors automated abuse with honeypots, rate limiting, JS challenges, CDP signals, a maze, and a real-time ip banning admin, defence config and fine tuning, and event monitoring.

Shuma-Gorath is designed to **complement enterprise bot defenses** (such as [Akamai Bot Manager](https://www.akamai.com/products/bot-manager_) as a second-layer of application-specific protection, but it can also run standalone.

## üêô Quickstart (Official)

```bash
# One-time setup (installs Rust, Spin, cargo-watch)
make setup

# Show the local dashboard login key generated by setup
make api-key-show

# If commands are missing, open a new terminal or run:
# source ~/.zshrc

# Start the dev server (official path)
make dev
```

Dashboard:
- `http://127.0.0.1:3000/dashboard/index.html`
- `http://127.0.0.1:3000/dashboard` (redirects to `/dashboard/index.html`)
- Tabbed SPA routes: `#monitoring`, `#ip-bans`, `#status`, `#config`, `#tuning`
- Dashboard UI is built with SvelteKit static output (`dist/dashboard`) and served by Spin.
- Charts use local vendored runtime (`dashboard/static/assets/vendor/chart-lite-1.0.0.min.js`) rather than CDN scripts.
- `make dev` forces local-write defaults (`WRITE=true`) so config controls are usable in local sessions.
- Override dev defaults with Make variables when needed (example: `make dev DEV_ADMIN_CONFIG_WRITE_ENABLED=false`).

Notes:
- Run setup in an interactive terminal (it may prompt for sudo to install Spin).
- `make setup` creates `.env.local` (gitignored) and auto-generates local dev secrets.
- Use the Makefile for all build/run/test flows.

## üêô Common Commands

```bash
make dev              # Start dev server with file watching
make test             # Full suite: unit + integration + dashboard e2e (requires running server)
make test-unit        # Unit tests only
make test-integration # Integration tests (requires running server)
make stop             # Stop Spin server
make status           # Check server status
make api-key-show     # Show local dashboard login key from .env.local
make help             # Show all commands
```

## üêô Configuration

- Full, canonical variable reference (env-only keys + KV tunables): `docs/configuration.md`
- Env-only override source: `.env.local` (generated by `make setup`, gitignored)
- Canonical defaults (seeded into KV): `config/defaults.env`
- Supported env-only overrides helper: `make env-help`

Deployment policy note: `SHUMA_KV_STORE_FAIL_OPEN` is a critical choice (fail-open vs fail-closed) when the KV store is unavailable. See `docs/security-hardening.md` and `docs/deployment.md`.

## üêô Documentation

- [`docs/index.md`](docs/index.md) - Docs index
- [`docs/project-principles.md`](docs/project-principles.md) - Project goals and engineering principles
- [`docs/adr/README.md`](docs/adr/README.md) - Architecture decision record process
- [`CONTRIBUTING.md`](CONTRIBUTING.md) - Contribution standards and PR expectations
- [`AGENTS.md`](AGENTS.md) - Instructions for coding agents assisting contributors
- [`docs/quick-reference.md`](docs/quick-reference.md) - Command and API cheat sheet
- [`docs/testing.md`](docs/testing.md) - Testing guide (Makefile-only)
- [`docs/dashboard.md`](docs/dashboard.md) - Dashboard and admin UI
- [`docs/deployment.md`](docs/deployment.md) - Production/deploy configuration
- [`docs/api.md`](docs/api.md) - API usage and endpoint details
- [`docs/configuration.md`](docs/configuration.md) - Runtime configuration reference
- [`docs/security-hardening.md`](docs/security-hardening.md) - Deployment security checklist
- [`docs/observability.md`](docs/observability.md) - Prometheus/Grafana integration
- [`docs/bot-defence.md`](docs/bot-defence.md) - Shuma-Gorath layered defence strategy with managed edge bot protection
- [`docs/features.md`](docs/features.md) - Feature list and roadmap
- [`docs/challenge-verification.md`](docs/challenge-verification.md) - Human verification strategy
- [`docs/maze.md`](docs/maze.md) - Maze runtime flow, rollout phases, and cost-asymmetry model
- [`todos/security-review.md`](todos/security-review.md) - Security audit notes / backlog

## üêô Repository Structure (High Level)

```
src/        # Core bot defence logic (Spin component)
dashboard/  # SvelteKit dashboard source + legacy runtime bridge modules
dist/       # Build artifacts (wasm + generated dashboard static output)
scripts/    # Build helpers (Makefile used by default)
```
